# Ground Truth Attempt Generator for Box and Blocks

## Requirements
Python 3

## Installation
1) Download the repository as a .zip file and unzip it to a preferred destination.
2) In a terminal of your choice, travel to the inside of directory CMORE-GT-GEN-main.
3) Run the following commands in order:
```
python3 -m venv venv
source venv/bin/activate
pip3 install -r requirements.txt
```
4) The Ground Truth Generator is now ready for use.

## Usage for attempt_labeler.py
attempt_labeler.py is the script that you can use to define at which intervals the attempt starts and ends. Whether or not these attempts were a successful block drop will be processed at a later step by attempt_classifier.py.

1) If you haven't already, run
```
source venv/bin/activate
```
2) Run
```
python3 label_generator.py [path to video file]
```
For instance, if I wanted to run the label generator on test.mp4 which is in the same directory is label_generator.py, I would run:
```
python3 label_generator.py test.mp4
```
3) A new window will pop up, allowing you to review the video frame-by-frame.
4) Press any key to advance a frame (you can also hold any key to rapidly advance through frames).
5) When you want to mark the start of an attempt, press '1'
6) When you want to mark the end of an attempt, press '2' 

   NOTE: A new row for the attempt will be appended to the resulting csv file after the script finishes.
8) Press 'r' ro rewind (holding r to rapidly move backward through frames also works).

   NOTE: While rewinding, if you rewind past where an attempt spans, that attempt will automatically be deleted off of the resulting csv file. For instance, if Attempt 4 lasted from frame 50 to 100, and you rewinded to before frame 100, Attempt 4 will be erased.
10) The script will automatically generate a csv file of all the attempts noted in each row when you get to the end of the video. It will have the name [video_name]_attempt_ground_truth.csv

## Usage for attempt_classifier.py
attempt_classifier.py reads in the resulting csv generated by attempt_labeler.py and displays each interval for the user to view. It will keep looping each interval until a classification by the user has been made until all attempts are processed. At the end, a final csv file containing attempt intervals and whether or not the attempt had a successful block drop will be generated.

1) If you haven't already, run
```
source venv/bin/activate
```

2) Run
```
python3 attempt_classifier.py [path to csv file generated from attempt_labeler.py] [path to source video that the csv file was generated from]
```

If I wanted to run the script on the csv generated by the example in the last section, I would run:
```
python3 attempt_classifier.py test_attempt_ground_truths.csv test.mp4
```
NOTE: This script supports .mp4 and .mov files.

3) Each attempt denoted the csv generated by label_generator.py will displayed in a new window for you to view. 

NOTE: Press 'j' to go back 1 frame, and 'k' to go forward 1 frame. Press 'h' to go back 10 frames, and 'l' to go forward 10 frames.

TIP: Hold down the key to move through the video rapidly. 

4) Press '0' to mark this attempt as a negative block drop, '1' to mark it as a positive block drop, and '2' to flag it for review. 

NOTE: More information on the flagging option will be detailed in the "Flagging Options" Section.

NOTE: Once a decision has been made, the script will move onto the next interval. 

5) When you have proccessed all the attempts, a new csv file by the name of [name of original csv file]_classified.csv will automatically be generated. This is the final ground truth file that contains when each attempt happens and whether or not the attempt was successful.

### Flagging Options
Pressing '2' will bring up a new menu with different flagging options. The flagging options are: 

<img width="926" alt="image" src="https://github.com/user-attachments/assets/adc8a828-9a9f-4125-b523-54f1ff66e85b" />

```
w: Block transferred, fingers did not cross (will mark the "ground_truth_block_column" with 2)
e: Block transferred, fingers might not have crossed (will mark the "ground_truth_block_column" with 3)
r: Needs manual review (will mark the "ground_truth_block_column" with 4)
t: Custom reason (type your own) (will mark the "ground_truth_block_column" with 5)
2: Back to main menu
```
Pressing '2' will cancel the flagging menu and bring you back to the main menu where you can mark the attempt as a positive, negative, or flagged one.

Pressing 't' will bring up a text box on the image that can be used to input a custom reason for flagging

<img width="919" alt="image" src="https://github.com/user-attachments/assets/f5c9d110-40d1-46de-a4a5-f835cbf73b58" />

Press enter to mark the custom reason in the csv. Press they escape key to go back into the flagging menu.

When attempts are flagged, ground_truth_block_column in the resulting csv will be updated with the respective numeric codes. The is_flagged column will be marked as 1. Finally, The "reason_for_flag" column will include a string that explains why the attempt was flagged.
